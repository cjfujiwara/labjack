# BigShim
This code operates the BigShim which the lattice lab uses to cancels out drifts in the local field in the lab (mainly electrical power and TTC).

The basic operating principle uses a [FL1-100](https://www.stefan-mayer.com/en/products/magnetometers-and-sensors/fluxgate-sensor-fl1-100.html) Flux Gate
magnetic field sensor. Some important properties
- +- 1 Gauss Sense Range
- 10 mV/mG sensitivity
- low noise
- no hysterisis

The sensor is placed around 1 meter away from the atoms with its measurements axis to be parallel with the feshbach field direction (vertical). If assume that field fluctuations in the room have a wavelength longer than 2 meters,
then any fluctuation in field at the sensor location is the same at the location of the atoms.  We built a large shim coil so that the field profile at the location of the sensor is roughly equal the field generated 
at the location of the atoms. Thus, stabilizing the magnetic field at the sensor will stabize the field at the atoms. An important factor is that the presence of any local fields such as those generated by the experiments' electromagnets
will create a bias field at the sensor location.  Thus, the field must be stabilized at a specific setpoint.  This also means that the sensor has be to be sufficnetly far away from any electromagnets so 
as not require a stabilization field outside of the 1G range of the device.

An initial discussion of the Big Shim can be found [here](https://docs.google.com/presentation/d/1-JlIjbozoPRU63ZKhApEn-joSrciZfajlC-b8FjDk5w/edit#slide=id.g2b14b3b4ab5_0_38)

## Shim Coil
The shim coils propeties will be listed here, as well as some MATLAB code.

## Driving Electronics
The coils are currently driven by a laser diode current controller [LDC 340](https://www.thorlabs.com/thorproduct.cfm?partnumber=LDC340), where the DAC0 output of the labjack drives the analog voltage current control. It has a sensitivity of 400 mA/V using the MOD IN.

## LUA PID Code
This code is the key to running the Big Shim PID. This does the following
- read in FluxGate sensor value
- determines the set points
- reads in whether the PID should be active
- writes the current field, set point, and PID status to labjack RAM
- performs PID
- performs 60 Feedforward
- outputs the DAC0 [0,5V] to control the current in the Shim

  LUA code in labjack is useful because it does not require an external computer to run it.  This is important because this labjack is not just a monitoring tool, it performs actual feedback. And so it needs to be run outside of any other devices.  See the [LUA scripting page](https://support.labjack.com/docs/25-0-lua-scripting-t-series-datasheet) for information on how to write LUA scripts. The main feature we desire however is that you
  (1) upload the LUA script
  (2) save it to memory
  (3) have it automatically run on device restart

## Python Monitoring Code
The python monitoring code BigShim_Monitor.py is a simple piece of code that reads in the RAM values as specified by the LUA PID Code.  It then displays some rumintenary information about the PID performance. It also saves the most recent PID trigger to file as lastlog.mat

## 60 Hz Feedforward
